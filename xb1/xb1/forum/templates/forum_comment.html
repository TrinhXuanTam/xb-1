{% for comment in comments %}
    <li>

    <div class="comment">
        <img class=comment_profile_pic src="{{comment.author.image.url}}">
        <div class="comment_content">	
            <div class= "comment_header">	
                <div class="comment_nickname">{{comment.author.nickname}}</div>
                <div class="comment_date">{{comment.date}}</div>
            </div>
            <div class="comment_text">{{comment.text}}</div>

            {% if user.is_authenticated %}
                <button class="comment_section_button" id="button_comment_{{comment.id}}" onclick="showReply('comment_{{comment.id}}')">Reply</button>

                <div id="comment_{{comment.id}}" style="display: none" >
                    <form id="{{comment.id}}" class="comment_reply_form" method="POST">
                        {% csrf_token %}
                        <textarea required rows=1 placeholder="Add a reply"></textarea>
                        <button class="comment_section_button">Reply</button>
                    </form>
                </div>

                <script>
                    function showReply(comment_id) {
                        var x = document.getElementById(comment_id);
                        x.style.display = "block";

                        var y = document.getElementById("button_" + comment_id);
                        y.style.display = "none";
                    }
                </script>

                <!-- Post a comment -->
                <script>
                    $(".comment_reply_form").submit(function(event) {
                        event.preventDefault();
                        ref = $(this)
                        $.ajax({
                            type:'POST',
                            async: true,
                            cache: false,
                            url:'{% url "forum:post_comment" %}',
                            data: {
                                csrfmiddlewaretoken: $(this).find("input[type='hidden']").val(),
                                forum_id: "{{ object.pk }}",
                                text: $(this).find("textarea").val(),
                                comment_id: ref.attr('id')
                            },
                            success: function(data) {
                                ref.parents().eq(2).find(".comment_reply").prepend(data)
                                ref.find("textarea").val('')
                            }
                        });
                    })
                </script>
            {% endif %}
        </div>
    </div>

    {% if comment.comments|length %}
        <div class="subcomments">
            <ul>
                {% include "forum_comment.html" with comments=comment.comments %}
            </ul>
        </div>
    {% endif %}
    </li>
{%endfor%}
