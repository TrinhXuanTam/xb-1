{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{%block include%}
<link rel="stylesheet" href="{% static 'css/article_form.css' %}" />
<script type="text/javascript" src="{% static "ckeditor/ckeditor-init.js" %}"></script>
<script type="text/javascript" src="{% static "ckeditor/ckeditor/ckeditor.js" %}"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
{% endblock %}

{%block content%}
<form id ="article_form" method="post" enctype="multipart/form-data">{% csrf_token %}
  <table>
    {% for field in form.visible_fields %}
      <tr>
        <th>{{ field.label_tag }}</th>
        <td>
          {{ field.errors }}
          {{ field }}
          {{ field.help_text }}
        </td>
      </tr>
    {% endfor %}
  </table>
  <input type="submit" value="{% trans "Submit" %}">
</form>

<script>
  $('#id_tags').select2({
	  tags: true,
    tokenSeparators: [','], 
    placeholder: "Add your tags here",
  });

  $('#id_tags').on("select2:selecting", function(e) {
    id  = e.params.args.data.id
    ref = $("#id_tags option[value=" + id + "]")
    $.ajax({
      type:'POST',
      cache: false,
      url:'{% url "articles:create_tag" %}',
      dataType: "json",
      data: {
          csrfmiddlewaretoken: "{{ csrf_token }}",
          tag_id: id,
          tag_text: ref.text()
        },

      statusCode: {
        201: function(data) {
          ref.val(data.tag_id)
        }
      }
    });
  });
</script>

<a class = "back" href="{% url 'articles:article_list' %}">{% trans "Back" %}</a> <br>
    </div>
{% endblock %}
